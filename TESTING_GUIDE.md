# 完整测试指南

## 快速启动

### 方式一: 使用启动脚本 (推荐)

```bash
cd /Users/allen/Downloads/exercise-tracker-main
chmod +x start-with-shop.sh stop-all-services.sh
./start-with-shop.sh
```

### 方式二: 手动启动

#### 1. 启动后端
```bash
cd backend
./mvnw spring-boot:run
```

#### 2. 初始化测试数据
等待后端启动完成(约30秒),然后执行数据库脚本:
```bash
# 使用你的数据库客户端工具执行
# 文件: backend/init-shop-data.sql
```

#### 3. 启动用户前端
```bash
cd userPortal
npm install  # 首次运行需要
npm start
# 访问: http://localhost:8100
```

#### 4. 启动管理前端
```bash
cd web-portal
npm install  # 首次运行需要
npm start
# 访问: http://localhost:4200
```

## 测试账号

### 创建测试账号
1. 访问用户前端: http://localhost:8100
2. 点击注册
3. 使用以下信息:
   - 用户名: `testuser`
   - 密码: `Test123456`

### 管理员账号
如果需要管理员登录webPortal,使用:
- 用户名: `coach1` (或其他已存在的coach账号)
- 密码: 查看数据库中的coach密码

## 完整测试流程

### 第一步: 注册并获取初始积分

1. **注册账号**
   - 访问 http://localhost:8100
   - 注册用户名 `testuser`, 密码 `Test123456`

2. **每日签到 (+20积分)**
   - 登录后点击底部 "Profile" 标签
   - 点击 "Check in (+20 points)" 按钮
   - ✅ 确认积分增加到 20

3. **添加运动记录 (+50积分/次)**
   - 点击底部 "Add" 标签
   - 选择运动类型(如RUN)
   - 输入时长(如30分钟)
   - 选择位置(室内/室外)
   - 点击保存
   - ✅ 确认积分增加到 70

4. **多次添加运动记录**
   - 重复添加6-8条运动记录
   - 每条记录 +50 积分
   - ✅ 最终积分应该在 370-470 之间

### 第二步: 浏览商城并购物

1. **浏览商品**
   - 点击底部 "Shop" 标签
   - 查看所有可用商品
   - ✅ 确认显示8个测试商品

2. **添加商品到购物车**
   - 选择一个300积分的商品(如"运动毛巾")
   - 点击 "Add to Cart"
   - ✅ 确认弹出成功提示

3. **再添加一个商品**
   - 选择一个价格合适的商品
   - 确保总价不超过你的积分
   - 添加到购物车

### 第三步: 管理购物车

1. **查看购物车**
   - 点击底部 "Cart" 标签
   - ✅ 确认看到刚才添加的商品

2. **调整数量**
   - 点击商品旁的 "+" 按钮增加数量
   - 点击 "-" 按钮减少数量
   - ✅ 确认总价实时更新

3. **删除商品**
   - 点击某个商品的垃圾桶图标
   - 确认删除
   - ✅ 确认商品被移除

### 第四步: 下单

1. **检查积分余额**
   - 查看顶部的积分显示
   - 确保积分充足

2. **提交订单**
   - 在购物车页面点击 "Checkout" 按钮
   - 确认订单信息
   - 点击 "Confirm"
   - ✅ 确认订单创建成功

3. **验证积分扣除**
   - 返回 "Profile" 页面
   - ✅ 确认积分已被扣除

4. **验证购物车清空**
   - 返回 "Cart" 页面
   - ✅ 确认购物车已清空

### 第五步: 查看订单历史

1. **在用户端(暂无订单历史页面)**
   - 当前版本用户端没有订单历史页面
   - 需要在管理端查看

2. **在管理端查看**
   - 访问 http://localhost:4200
   - 使用coach账号登录
   - 在Dashboard点击某个用户
   - 向下滚动到 "Purchase History" 部分
   - ✅ 确认看到刚才创建的订单

### 第六步: 测试边界情况

1. **积分不足时购买**
   - 添加总价超过当前积分的商品到购物车
   - 尝试结账
   - ✅ 确认显示"积分不足"错误

2. **重复签到**
   - 在同一天尝试再次签到
   - ✅ 确认显示"已经签到过"错误

3. **库存为0的商品**
   - 查看库存为0的商品
   - ✅ 确认"Add to Cart"按钮被禁用

## 商品列表

测试数据包含以下商品:

| 商品名称 | 积分 | 库存 |
|---------|------|------|
| 高级运动水杯 | 300 | 100 |
| 智能健身手环 | 400 | 50 |
| 专业瑜伽垫 | 350 | 80 |
| 运动背包 | 320 | 60 |
| 蛋白粉补剂 | 380 | 45 |
| 运动毛巾 | 280 | 120 |
| 跑步臂包 | 290 | 90 |
| 健身手套 | 310 | 70 |

## 积分系统总结

- **签到**: 20积分/天
- **运动记录**: 50积分/次
- **商品价格**: 280-400积分

建议测试积分累积:
- 签到1次: 20积分
- 添加8条运动记录: 400积分
- 总计: 420积分
- 可以购买任意商品组合

## 停止服务

```bash
./stop-all-services.sh
```

或手动停止:
```bash
# 查找进程
ps aux | grep -E "spring-boot|npm start"

# 停止进程
kill <PID>
```

## 常见问题

### 1. 端口被占用
```bash
# 检查端口占用
lsof -i :8080  # 后端
lsof -i :8100  # 用户前端
lsof -i :4200  # 管理前端

# 释放端口
kill -9 <PID>
```

### 2. 后端数据库连接失败
检查 `backend/src/main/resources/application.properties` 中的数据库配置

### 3. 前端无法连接后端
确认:
- 后端已启动 (http://localhost:8080)
- 浏览器控制台没有CORS错误
- API地址配置正确

## 日志位置

- 后端: `logs/backend.log`
- 用户前端: `logs/userportal.log`
- 管理前端: `logs/webportal.log`

## 技术支持

如遇问题,请检查:
1. Java版本 (需要17+)
2. Node.js版本 (需要18+)
3. 数据库是否正常运行
4. 网络代理设置
